<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StockBuilder</title>
</head>
  <body>
  <!-- ========================= -->
<!-- UI STYLE (STEP 2) -->
<!-- ========================= -->
<style>
  :root {
    --bg: #0b1020;
    --glass: rgba(255,255,255,0.08);
    --glass-border: rgba(255,255,255,0.18);
    --glow: 0 0 30px rgba(56,189,248,0.25);
    --primary: #38bdf8;
    --text-muted: #94a3b8;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: radial-gradient(circle at top, #0f172a, var(--bg));
    color: #fff;
    min-height: 100vh;
  }

  #app {
    padding: 16px;
    max-width: 480px;
    margin: 0 auto;
  }

  h1 {
    font-size: 1.4rem;
    margin: 0 0 12px;
  }

  p {
    margin: 0;
    color: var(--text-muted);
    font-size: 0.9rem;
  }

  /* ===== Glass Card ===== */
  .card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 18px;
    padding: 16px;
    margin-bottom: 14px;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    box-shadow: var(--glow);
  }

  /* ===== Header ===== */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .badge {
    background: rgba(56,189,248,0.15);
    color: var(--primary);
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.75rem;
    border: 1px solid rgba(56,189,248,0.4);
  }

  /* ===== Product Grid (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ STEP 5) ===== */
  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .product-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 12px;
    backdrop-filter: blur(12px);
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
  }

  .product-img {
    width: 100%;
    height: 110px;
    background: linear-gradient(135deg, #1e293b, #020617);
    border-radius: 12px;
    margin-bottom: 8px;
  }

  .product-name {
    font-size: 0.9rem;
    margin-bottom: 4px;
  }

  .product-price {
    color: var(--primary);
    font-weight: 600;
    font-size: 0.95rem;
  }

  /* ===== Admin Accent ===== */
  .admin {
    border-left: 3px solid var(--primary);
  }
</style>


  <!-- ========================= -->
  <!-- APP ROOT -->
  <!-- ========================= -->
  <div id="app"></div>

<!-- ========================= -->
<!-- GLOBAL STATE -->
<!-- ========================= -->
<script>
  const state = {
    mode: 'viewer',
    token: null,

    products: [],        // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å API
    filteredProducts: [],// ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô filter

    search: '',
    category: 'all',

    loading: false,
    error: null
  };
</script>

  <!-- ========================= -->
<!-- API CONFIG -->
<!-- ========================= -->
<script>
  const API_URL = 'PASTE_YOUR_APPS_SCRIPT_URL_HERE';
</script>


  <!-- ========================= -->
<!-- STATE INIT -->
<!-- ========================= -->
<script>
  function initState() {
    const savedToken = localStorage.getItem('admin_token');

    if (savedToken) {
      state.mode = 'admin';
      state.token = savedToken;
    } else {
      state.mode = 'viewer';
      state.token = null;
    }
  }

  function logoutAdmin() {
    localStorage.removeItem('admin_token');
    state.mode = 'viewer';
    state.token = null;
    renderUI();
  }
</script>

<!-- ========================= -->
<!-- API FUNCTIONS -->
<!-- ========================= -->
<script>
  async function apiRequest(action, payload = {}) {
    state.loading = true;
    state.error = null;
    renderUI();

    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action,
          token: state.token,
          payload
        })
      });

      const data = await res.json();

      if (!data.success) {
        throw new Error(data.message || 'API Error');
      }

      return data.data;
    } catch (err) {
      state.error = err.message;
      console.error(err);
      return null;
    } finally {
      state.loading = false;
      renderUI();
    }
  }

  /* ===== API WRAPPERS ===== */

  function apiListProducts() {
    return apiRequest('list');
  }

  function apiLogin(username, password) {
    return apiRequest('login', { username, password });
  }

  function apiAddProduct(product) {
    return apiRequest('add', product);
  }

  function apiUpdateProduct(product) {
    return apiRequest('update', product);
  }

  function apiUpdateStock(code, diff) {
    return apiRequest('updateStock', { code, diff });
  }
</script>

  <!-- ========================= -->
<!-- RENDER FUNCTIONS -->
<!-- ========================= -->
<script>
  function renderUI() {
    const app = document.getElementById('app');
    app.innerHTML = '';

    if (state.mode === 'viewer') {
      renderViewer(app);
    }

    if (state.mode === 'admin') {
      renderAdmin(app);
    }
  }

  /* ===== VIEWER ===== */

  function renderViewer(root) {
    const header = document.createElement('div');
    header.className = 'header';
    header.innerHTML = `
      <h1>üì¶ StockBuilder</h1>
      <span class="badge">Viewer</span>
    `;

    const searchCard = document.createElement('div');
    searchCard.className = 'card';
    searchCard.innerHTML = `
      <input
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."
        value="${state.search}"
        oninput="onSearch(this.value)"
        style="width:100%;padding:10px;border-radius:12px;border:none;"
      />

      <select
        onchange="onFilterCategory(this.value)"
        style="width:100%;margin-top:10px;padding:10px;border-radius:12px;border:none;"
      >
        <option value="all">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î</option>
        ${renderCategoryOptions()}
      </select>
    `;

    root.appendChild(header);
    root.appendChild(searchCard);

    if (state.loading) {
      root.appendChild(renderLoading());
      return;
    }

    if (state.error) {
      root.appendChild(renderError());
      return;
    }

    root.appendChild(renderProductGrid());
  }

  function renderProductGrid() {
    const grid = document.createElement('div');
    grid.className = 'grid';

    if (state.filteredProducts.length === 0) {
      const empty = document.createElement('div');
      empty.className = 'card';
      empty.innerHTML = `<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>`;
      return empty;
    }

    state.filteredProducts.forEach(p => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <div class="product-img"></div>
        <div class="product-name">${p.name}</div>
        <div class="product-price">‡∏ø${p.price}</div>
      `;
      grid.appendChild(card);
    });

    return grid;
  }

  function renderCategoryOptions() {
    if (state.products.length === 0) return '';
    const categories = [...new Set(state.products.map(p => p.category))];
    return categories.map(c => `<option value="${c}">${c}</option>`).join('');
  }

  function renderLoading() {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</p>`;
    return div;
  }

  function renderError() {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<p>‚ùå ${state.error}</p>`;
    return div;
  }

  /* ===== VIEWER LOGIC ===== */

  async function loadProductsOnce() {
    if (state.products.length > 0) return;

    const data = await apiListProducts();
    if (!data) return;

    state.products = data;
    applyFilter();
    renderUI();
  }

  function applyFilter() {
    state.filteredProducts = state.products.filter(p => {
      const matchSearch =
        p.name.toLowerCase().includes(state.search.toLowerCase());

      const matchCategory =
        state.category === 'all' || p.category === state.category;

      return matchSearch && matchCategory;
    });
  }

  function onSearch(value) {
    state.search = value;
    applyFilter();
    renderUI();
  }

  function onFilterCategory(value) {
    state.category = value;
    applyFilter();
    renderUI();
  }

  /* ===== ADMIN (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞) ===== */

  function renderAdmin(root) {
    const header = document.createElement('div');
    header.className = 'header';
    header.innerHTML = `
      <h1>üîê Admin Dashboard</h1>
      <button onclick="logoutAdmin()" class="badge">Logout</button>
    `;

    const card = document.createElement('div');
    card.className = 'card admin';
    card.innerHTML = `
      <p>‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
      <p>STEP 6 ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</p>
    `;

    root.appendChild(header);
    root.appendChild(card);
  }
</script>

  <!-- ========================= -->
<!-- APP START -->
<!-- ========================= -->
<script>
  initState();
  renderUI();
  loadProductsOnce(); // üëà ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
</script>


</body>
</html>
